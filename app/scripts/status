#!/usr/bin/env bash
### Usage:
###   status [--verbose]
### Options:
###   --help
###   --verbose   list more detailed output

#--HEAD--
# TODO: See if this can be added from a template
set -o nounset; set -o errexit
SCRIPT="$(test -L "$0" && readlink -e "$0" || readlink -e "$0")"
SCRIPT_NAME="$(basename "${SCRIPT}")"
SCRIPT_DIR="$(dirname "${SCRIPT}")"
source "${SCRIPT_DIR}/main.source"
#--/HEAD--

echo -e '\n/- HQ --------------------------------------------------------------------------'
"${SCRIPT_DIR}/headquarters" || true

echo -e '\n|- CONTAINERS ------------------------------------------------------------------'
lxc-ls --fancy --active "^starphleet"

echo -e '\n|- JOBS ------------------------------------------------------------------------'
initctl list | grep -e "^starphleet"

echo -e '\n|- ORDERS ----------------------------------------------------------------------'
if [[ -n "${STARPHLEET_HQ:-}" ]]; then
  find "${STARPHLEET_HQ_ROOT}" -name "orders" -exec \
    bash -c 'grep -e '^autodeploy' {} | tail -1 | awk '"'"'{print $2}'"'" \;
fi

echo -e '\n\-------------------------------------------------------------------------------'
