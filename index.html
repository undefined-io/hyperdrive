<!DOCTYPE html>
<html lang="en">
	<head>
		<title>Hyperdrive</title>
		<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
		<link rel="stylesheet" href="css/bootstrap.css">
		<link rel="stylesheet" href="css/tomorrow-night.css">
		<link rel="stylesheet" href="css/marked-docs.css">
		<style>
			.hyperdrive {
				background-image: url(./images/hyperdrive.png);
				background-position: 0px 0px, center;
				color: white;
				background-repeat: no-repeat;
				background-size: cover;
				opacity: 1;
				background-color: black;
			}
		</style>
	</head>
	<body>
		
<a href="https://github.com/undefined-io/hyperdrive"><img style="position: absolute; top: 0; right: 0; border: 0;" src="https://camo.githubusercontent.com/38ef81f8aca64bb9a64448d0d70f1308ef5341ab/68747470733a2f2f73332e616d617a6f6e6177732e636f6d2f6769746875622f726962626f6e732f666f726b6d655f72696768745f6461726b626c75655f3132313632312e706e67" alt="Fork me on GitHub" data-canonical-src="https://s3.amazonaws.com/github/ribbons/forkme_right_darkblue_121621.png"></a>
<div class="jumbotron hyperdrive">
	<div class="container-fluid">
		<h1>Hyperdrive</h1>
		<p>Auto Deploy PaaS using LXC and Buildpacks</p>
	</div>
</div>

<div class="container-fluid">
	<div class="row">
		
		<div class="col-md-3">
			<div class="toc">
					
					<h1><a href="#toc-0">Requirements / OS Support</a></h1>
					
					<h1><a href="#toc-1">Overview</a></h1>
					
					<h2><a href="#toc-2">Installation</a></h2>
					
					<h3><a href="#toc-3">Saucy</a></h3>
					
					<h3><a href="#toc-4">Vagrant</a></h3>
					
					<h1><a href="#toc-5">Terminology</a></h1>
					
					<h1><a href="#toc-6">Getting Started</a></h1>
					
					<h2><a href="#toc-7">Setup Headquarters Repo</a></h2>
					
					<h3><a href="#toc-8">Example</a></h3>
					
					<h2><a href="#toc-9">Assign Squadron to HQ</a></h2>
					
					<h1><a href="#toc-10">Where Hyperdrive Lives</a></h1>
					
					<h2><a href="#toc-11">/data/hyperdrive</a></h2>
					
					<h2><a href="#toc-12">/var/hyperdrive</a></h2>
					
					<h2><a href="#toc-13">/etc/hyperdrive</a></h2>
					
					<h1><a href="#toc-14">Orders</a></h1>
					
					<h1><a href="#toc-15">Developer Notes</a></h1>
					
					<h2><a href="#toc-16">Step By Step (Just Notes)</a></h2>
					
					<h3><a href="#toc-17">Bootstrap</a></h3>
					
					<h3><a href="#toc-18">Setting up HQ</a></h3>
					
					<h3><a href="#toc-19">Setup the Base Hulls</a></h3>
					
					<h3><a href="#toc-20">Launch a Ship</a></h3>
					
					<h2><a href="#toc-21">Hacking on Hyperdrive with Vagrant</a></h2>
					
					<h3><a href="#toc-22">Symlink Approach</a></h3>
					
					<h3><a href="#toc-23">Github Approach</a></h3>
					
			</div>
		</div>
		<div class="col-md-9">
		
			<p>Hyperdrive is a toolkit for turning a virtual or physical machine infrastructure into a continuous
deployment stack.</p>
<p>This is a fork of <code>wballard/starphleet</code>, and uses many of the original ideas, but a different
approach to the implementation.</p>
<h1 class="anchor" id="toc-0">Requirements / OS Support</h1>
<p>Currently Hyperdrive is only supported on Ubuntu 14.04.</p>
<h1 class="anchor" id="toc-1">Overview</h1>
<p>This version of hyperdrive is still under heavy development, and many critical pieces are missing.
It is not meant for a production install anywhere.</p>
<p>Installation is really only recommended to see the limited working features in action.</p>
<h2 class="anchor" id="toc-2">Installation</h2>
<h3 class="anchor" id="toc-3">Saucy</h3>
<pre><code class="hljs lang-bash"><span class="hljs-comment"># On most systems, the following will suffice to install Hyperdrive</span>
bash &lt;(curl https://raw.githubusercontent.com/undefined-io/hyperdrive/master/bootstrap)
</code></pre>
<h3 class="anchor" id="toc-4">Vagrant</h3>
<p>The Vagrantfile that comes with the current version or hyperdrive should allow installation on
parallels, vmware and virtualbox.</p>
<p><strong>NOTE OSX/MAC USERS:</strong> <em>If you have just installed Vagrant, and still have the &quot;Vagrant&quot; pkg
mounted, your install of Hyperdrive will fail. You&#39;ll have to unmount the pkg first before you try
to start up the image</em></p>
<pre><code class="hljs lang-bash"><span class="hljs-comment"># Run the following export(s), then choose the file that fit your vm software</span>
<span class="hljs-keyword">export</span> HYPERDRIVE_VAGRANT_MEMSIZE=<span class="hljs-number">4096</span>

<span class="hljs-comment"># Parallels</span>
./parallels

<span class="hljs-comment"># VMware</span>
./vmware

<span class="hljs-comment"># Virtualbox</span>
./virtualbox
</code></pre>
<h1 class="anchor" id="toc-5">Terminology</h1>
<p>Hyperdrive uses a spaceship theme to describe the working environments. Here is a list of the different terms.</p>
<ul>
<li><strong>Fleet</strong> - A collection of squadarons</li>
<li><strong>Squadron</strong> - A collection of ships. (<em>VM, Server, etc...</em>)</li>
<li><strong>Headquarters</strong> - A place for squadrons to obtain orders</li>
<li><strong>Ship</strong> - Ships are responsible for completing assignments. (<em>LXC</em>)</li>
<li><strong>Assignment</strong> - Task assigned to a ship based on orders from the HQ. (<em>Application, Service, etc...</em>)</li>
<li><strong>Orders</strong> - Contain all the information for a ship to complete an assignment.</li>
<li><strong>Admiral</strong> - In charge of the fleet, and has full access to every squadron</li>
<li><strong>Hull</strong> - Framework for a ship</li>
</ul>
<h1 class="anchor" id="toc-6">Getting Started</h1>
<h2 class="anchor" id="toc-7">Setup Headquarters Repo</h2>
<p>Headquarters are just GIT repositories that contain a hyperdrive specific directory structure and
tell each Captain in the fleet what to do.</p>
<h3 class="anchor" id="toc-8">Example</h3>
<pre><code class="hljs">|<span class="hljs-comment">-- authorized_keys</span>
|   `<span class="hljs-comment">-- john.doe@hyperdrive.com.pub</span>
|<span class="hljs-comment">-- nodejs-ship</span>
|   `<span class="hljs-comment">-- orders</span>
`<span class="hljs-comment">-- python-ship</span>
    `<span class="hljs-comment">-- orders</span>
</code></pre><ul>
<li><strong>/authorized_keys</strong> - contains public keys for admiral access</li>
<li><strong>/nodejs-ship/orders</strong> - orders with an assignment called &#39;nodejs-ship&#39;</li>
<li><strong>/python-ship/orders</strong> - orders with an assignment called &#39;python-ship&#39;</li>
</ul>
<h2 class="anchor" id="toc-9">Assign Squadron to HQ</h2>
<pre><code class="hljs lang-bash"><span class="hljs-comment"># This will setup a clone of the HQ in "/data/hyperdrive/headquarters" (default path)</span>
headquarters <span class="hljs-keyword">set</span> &lt;REPO_URL&gt; --sync
</code></pre>
<p>If you want the Captain to obtain new orders from the HQ automatically, you can do that by:</p>
<pre><code class="hljs lang-bash">start hyperdrive-captain-obtain-orders
</code></pre>
<p>This will make the captain check with the configured HQ every minute, to see if any updates or new
orders are available.</p>
<h1 class="anchor" id="toc-10">Where Hyperdrive Lives</h1>
<p>These are the default locations. <strong>NOTE</strong> Many of these locations are still changing during the
refactor.</p>
<h2 class="anchor" id="toc-11">/data/hyperdrive</h2>
<p>The Hyperdrive data directory. The GIT repo lives here, and other files related to keeping track of
Hyperdrive related stuff.</p>
<pre><code class="hljs">|<span class="hljs-comment">-- git</span>
|<span class="hljs-comment">-- includes</span>
|<span class="hljs-comment">-- bootstrap.log</span>
|<span class="hljs-comment">-- lxc</span>
`<span class="hljs-comment">-- records</span>
    `<span class="hljs-comment">-- system.files</span>
</code></pre><ul>
<li><strong>/git/</strong> - The Hyperdrive GIT repo</li>
<li><strong>/includes/</strong> - Environment files that will be used as hyperdrive runs (after install, this is empty)</li>
<li><strong>/bootstrap.log</strong> - Inital setup log from when the system was bootstrapped</li>
<li><strong>/lxc/</strong> - The root of the container file system</li>
<li><strong>/records/system.files</strong> - A list of files that were installed in system folders (/etc/ /usr/bin/ ...)</li>
</ul>
<h2 class="anchor" id="toc-12">/var/hyperdrive</h2>
<pre><code class="hljs">|<span class="hljs-comment">-- containers</span>
|<span class="hljs-comment">-- nginx</span>
|   |<span class="hljs-comment">-- hosts</span>
|   |<span class="hljs-comment">-- proxies</span>
|   |<span class="hljs-comment">-- overrides</span>
|   `<span class="hljs-comment">-- upstream</span>
|<span class="hljs-comment">-- private_keys</span>
|<span class="hljs-comment">-- public_keys</span>
`<span class="hljs-comment">-- scripts</span>
    `<span class="hljs-comment">-- lib</span>
</code></pre><ul>
<li><strong>/containers/</strong> - The actual images of the running LXC are stored here</li>
<li><strong>/nginx/hosts/</strong> -</li>
<li><strong>/nginx/proxies/</strong> -</li>
<li><strong>/nginx/overrides/</strong> -</li>
<li><strong>/nginx/upstream/</strong> - Loadmaster config to have one access point for all workstations</li>
<li><strong>/private_keys/</strong> - Private keys used to access remote GIT repos</li>
<li><strong>/public_keys/</strong> - Public keys for admiral access</li>
<li><strong>/scripts/</strong> - The main hyperdrive scripts</li>
<li><strong>/scripts/lib/</strong> - Support files for the main hyperdrive scripts</li>
</ul>
<h2 class="anchor" id="toc-13">/etc/hyperdrive</h2>
<pre><code class="hljs">`<span class="hljs-comment">-- main.conf</span>
</code></pre><ul>
<li><strong>/main.conf</strong> - Master settings for Hyperdrive intall</li>
</ul>
<h1 class="anchor" id="toc-14">Orders</h1>
<p>The <code>orders</code> file is used to configure environment variables specific to the app and Hyperdrive.</p>
<table class="table table-condensed table-hover">
<thead>
<tr>
<th>setting</th>
<th>description</th>
</tr>
</thead>
<tbody>
<tr>
<td>autodeploy <code>&lt;repo&gt;</code></td>
<td>monitored repo</td>
</tr>
<tr>
<td>export <strong>PORT</strong>=<code>&lt;n&gt;</code></td>
<td>port of application</td>
</tr>
<tr>
<td>export <strong>PUBLISH_PORT</strong>=<code>&lt;n&gt;</code></td>
<td>port on which the app will respond to external requests (defaults to PORT)</td>
</tr>
<tr>
<td>export <strong>PUBLISH_HOST</strong>=<code>&lt;host&gt;</code></td>
<td>If specified, app will only respond for the specified host headers (eg. <code>*.undefined.io undefined.io</code>)</td>
</tr>
<tr>
<td>export <strong>PUBLISH_ROOT</strong>=<code>&lt;path&gt;</code></td>
<td>The path on the domain which will serve as the root for the app</td>
</tr>
</tbody>
</table>
<h1 class="anchor" id="toc-15">Developer Notes</h1>
<p>If you are using the provided <code>Vagrantfile</code>, your box will have the working copy of hyperdrive
located at <code>/vagrant</code> on your VM. This comes in handy, for testing changes prior to them being installed.</p>
<h2 class="anchor" id="toc-16">Step By Step (Just Notes)</h2>
<p>Much of this will be improved during the dev cycle, but trying to allow devs to understand what I&#39;m
doing atm while developing.</p>
<h3 class="anchor" id="toc-17">Bootstrap</h3>
<pre><code class="hljs lang-bash"><span class="hljs-comment"># This sets up the basics</span>
/vagrant/bootstrap <span class="hljs-string">""</span> <span class="hljs-string">""</span> <span class="hljs-string">"file:///vagrant"</span> <span class="hljs-string">""</span>
</code></pre>
<h3 class="anchor" id="toc-18">Setting up HQ</h3>
<pre><code class="hljs lang-bash"><span class="hljs-comment"># Setup HQ and monitor for updated orders</span>
<span class="hljs-built_in">cd</span> /var/hyperdrive/scripts/
./headquarters <span class="hljs-keyword">set</span> https://github.com/datfinesoul/hyperdrive-hq<span class="hljs-comment">#master</span>
start hyperdrive-captain-obtain-orders

<span class="hljs-comment"># To see logs</span>
<span class="hljs-built_in">tail</span> -F /var/log/upstart/hyperdrive*
</code></pre>
<h3 class="anchor" id="toc-19">Setup the Base Hulls</h3>
<p>All Ships use some standard Hulls, which need to be assembled once, when a Hyperdrive
Squadron is created.  This process is rather lengthy, but rarely (if ever) needs to be repeated.</p>
<p><em>This automatically happens when <code>hd assemble</code> is used (see below), but this is how it&#39;s done
explicitly</em></p>
<pre><code class="hljs lang-bash">/var/hyperdrive/scripts/hull-build

<span class="hljs-comment"># hull-build: hull 'hyperdrive' is missing and will now be created...</span>
<span class="hljs-comment"># hull-build: log available at /data/hyperdrive/lxc-hyperdrive-create.log</span>
<span class="hljs-comment"># hull-build: hull 'hyperdrive' ready</span>
<span class="hljs-comment"># hull-build: hull 'hyperdrive-basic-hull' is missing and will now be created...</span>
<span class="hljs-comment"># Created container hyperdrive-basic-hull as snapshot of hyperdrive</span>
<span class="hljs-comment"># hull-build: log available at /data/hyperdrive/lxc/hyperdrive-basic-hull/setup.log</span>
<span class="hljs-comment"># hull-build: hull 'hyperdrive-basic-hull' ready</span>
</code></pre>
<h3 class="anchor" id="toc-20">Launch a Ship</h3>
<pre><code class="hljs lang-bash"><span class="hljs-comment"># "example" is the name of an order in the HQ</span>
hd assemble <span class="hljs-string">"example"</span>

<span class="hljs-comment"># hull-build: hull 'hyperdrive' ready</span>
<span class="hljs-comment"># hull-build: hull 'hyperdrive-basic-hull' ready</span>
<span class="hljs-comment"># ship-build: pulling specs for new 'hyperdrive-example' ship</span>
<span class="hljs-comment"># git-clone: no branch provided, so looking up the default branch in the repo</span>
<span class="hljs-comment"># git-clone: REMOTE_HEAD_SHA: 9025762f734b1eb4d4314473e3dd03cf89130a23, REMOTE_HEAD_BRANCH: master</span>
<span class="hljs-comment"># git-clone: REMOTE_REPO: https://github.com/undefined-io/website, REMOTE_BRANCH: master</span>
<span class="hljs-comment"># git-clone: replacing empty dir '/tmp/hyperdrive-example.vZvFVx19' with 'https://github.com/undefined-io/website#master'</span>
<span class="hljs-comment"># Cloning into '/tmp/hyperdrive-example.vZvFVx19'...</span>
<span class="hljs-comment"># remote: Counting objects: 21, done.</span>
<span class="hljs-comment"># remote: Compressing objects: 100% (17/17), done.</span>
<span class="hljs-comment"># remote: Total 21 (delta 0), reused 19 (delta 0)</span>
<span class="hljs-comment"># Checking connectivity... done.</span>
<span class="hljs-comment"># ship-build: ship 'hyperdrive-example-9025762' is missing and will now be created...</span>
<span class="hljs-comment"># ship-build: setup 'hyperdrive-example-9025762' starting</span>
<span class="hljs-comment"># Created container hyperdrive-example-9025762 as snapshot of hyperdrive-basic-hull</span>
<span class="hljs-comment"># ship-build: log available at /data/hyperdrive/lxc/hyperdrive-example-9025762/setup.log</span>
<span class="hljs-comment"># ship-build: setup 'hyperdrive-example-9025762' completed... build starting</span>
<span class="hljs-comment"># ship-build: build 'hyperdrive-example-9025762' completed</span>
<span class="hljs-comment"># ship-build: ship 'hyperdrive-example-9025762' ready</span>

hd engage <span class="hljs-string">"hyperdrive-example-9025762"</span>

hd launch <span class="hljs-string">"hyperdrive-example-9025762"</span>
</code></pre>
<h2 class="anchor" id="toc-21">Hacking on Hyperdrive with Vagrant</h2>
<h3 class="anchor" id="toc-22">Symlink Approach</h3>
<p>The easiest way to hack on Hyperdrive is usually to use Vagrant and then symlink the folders of files you are working on.</p>
<pre><code class="hljs lang-bash">vagrant ssh
<span class="hljs-built_in">sudo</span> su -
<span class="hljs-built_in">cd</span> /var/hyperdrive
<span class="hljs-built_in">mv</span> scripts scripts.bak
<span class="hljs-built_in">ln</span> <span class="hljs-operator">-s</span> /vagrant/app/scripts/
</code></pre>
<p>Then just work on the scripts in your local directories using your favorite editors, and test out the results immediately.</p>
<p><strong>NOTE:</strong> Running <code>install</code> will wipe out all the symlinks.</p>
<h3 class="anchor" id="toc-23">Github Approach</h3>
<p>If you prefer to check in all changes, use the push/install approach.</p>
<pre><code class="hljs lang-bash"><span class="hljs-comment"># On the Hyperdrive system or VM:</span>
<span class="hljs-built_in">cd</span> /var/hyperdrive/scripts
./install
</code></pre>
<p>This pulls the latest changes and upgrades hyperdrive. The repo that you pull from will come from the <code>/etc/hyperdrive/main.conf</code> file (HYPERDRIVE_REMOTE)</p>

		</div>
	</div>
</div>

	</body>
</html>
