# vi: set ft=upstart ts=2 et sw=2 sts=2 :
description "The Captain regularily communicates with HQ to obtain new orders"

env SCRIPT_NAME="starphleet-captain-obtain-orders.conf"

# this job will respawn/re-run after 30 seconds
# the respawn limit of at most 1 respawn in 15 seconds, is to shut the job down if something is wrong
respawn
respawn limit 1 15

script
  source "/etc/starphleet/main.conf" || exit 0
  source "${STARPHLEET_ROOT}/scripts/main.source" || exit 0

  "${STARPHLEET_SCRIPTS}/headquarters" --sync
  sleep 30

  # this exit will force the respawn to keep the job running
  exit 1
end script
