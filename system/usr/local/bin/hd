#!/usr/bin/env bash

# NOTE: These are just the beginnings of experimenting with a central "router"
# TODO: Need to make this source the main files, maybe this file should be generated on install?

COMMAND="${1}"
shift
source "/etc/hyperdrive/main.conf" || exit 0
SCRIPT_DIR="${HYPERDRIVE_ROOT}/scripts"
case "${COMMAND}" in
  pilot)
    # attaches to lxc logged in as user ubuntu
    [[ -n "${1}" ]] && lxc-attach --name="${1}" -- sudo -H -u ubuntu -i bash
    ;;
  decommission)
    [[ -n "${1}" ]] && lxc-destroy -f --name="${1}"
    ;;
  assignment)
    COMMAND="${1}"
    shift
    case "${COMMAND}" in
      start)
        [[ -n "${1}" ]] && start hyperdrive-assignment name="${1}"
        ;;
      stop)
        [[ -n "${1}" ]] && stop hyperdrive-assignment name="${1}"
        ;;
    esac
    ;;
  join-formation)
    [[ -n "${1}" ]] && "${SCRIPT_DIR}/ship-join-formation" "${1}"
    ;;
  build)
    # TODO: Need to add an option here for this to not require params so hull-build can execute
    [[ -n "${1}" ]] && "${SCRIPT_DIR}/ship-build" name "${1}" --running
    ;;
  status)
    "${SCRIPT_DIR}/status"
    ;;
  headquarters)
    "${SCRIPT_DIR}/headquarters" $@
    ;;
  *)
    echo "hd: ERROR" || false
    ;;
esac

#"${SCRIPT_DIR}/${SCRIPT_NAME}" $@
